<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>mlr3fselect • mlr3fselect</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/journal/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<link href="../extra.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="mlr3fselect">
<meta property="og:description" content="mlr3fselect">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a href="https://mlr-org.com"><img src="https://raw.githubusercontent.com/mlr-org/mlr3/master/man/figures/logo.png" id="hexlogo" alt="mlr-org"></a>
        <a class="navbar-brand" href="../index.html">mlr3fselect <small>v0.1.0-9000</small></a>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="../articles/mlr3fselect.html">Get started</a>
</li>
        <li>
  <a href="https://github.com/mlr-org/mlr3fselect/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://lmmisld-lmu-stats-slds.srv.mwn.de/mlr_invite/">
    <span class="fa fa fa fa-comments"></span>
     
  </a>
</li>
<li>
  <a href="https://stackoverflow.com/questions/tagged/mlr3">
    <span class="fab fa fab fa-stack-overflow"></span>
     
  </a>
</li>
<li>
  <a href="https://mlr-org.com/">
    <span class="fa fa-rss"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>mlr3fselect</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mlr-org/mlr3fselect/blob/master/vignettes/mlr3fselect.Rmd"><code>vignettes/mlr3fselect.Rmd</code></a></small>
      <div class="hidden name"><code>mlr3fselect.Rmd</code></div>

    </div>

    
    
<p>In this tutorial, we introduce the <code>mlr3fselect</code> package by comparing feature selection methods on the titanic disaster data set. The objective of feature selection is to enhance the interpretability of the model, speed up the learning process and increase the predictive performance.</p>
<div id="titanic-data-set" class="section level2">
<h2 class="hasAnchor">
<a href="#titanic-data-set" class="anchor"></a>Titanic data set</h2>
<p>The <a href="https://www.kaggle.com/c/titanic/data">Titanic data set</a> contains data for 887 Titanic passengers, including whether they survived when the titanic sank. Our goal will be to predict the survival of the titanic passengers.</p>
<p>After loading the data set from the <code>mlr3data</code> package, we impute the missing age values with the median age of the passengers and remove <code>character</code> features. We could use feature engineering to create new features from the <code>character</code> features, however we want to focus on feature selection in this tutorial.</p>
<p>In addition to the <code>survived</code> column, the reduced data set contain for each passenger the following attributes:</p>
<ul>
<li>
<code>age</code> Age</li>
<li>
<code>sex</code> Sex</li>
<li>
<code>sib_sp</code> Number of siblings/ spouses aboard</li>
<li>
<code>parch</code> Number of parents/ children aboard</li>
<li>
<code>fare</code> Fair paid</li>
<li>
<code>pc_class</code> Passenger class</li>
</ul>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"titanic"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"mlr3data"</span>)

<span class="no">titanic</span>$<span class="no">age</span>[<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">titanic</span>$<span class="no">age</span>)] <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span>(<span class="no">titanic</span>$<span class="no">age</span>, <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">titanic</span>$<span class="no">embarked</span>[<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">titanic</span>$<span class="no">embarked</span>)] <span class="kw">=</span> <span class="st">"S"</span>
<span class="no">titanic</span>$<span class="no">ticket</span> <span class="kw">=</span> <span class="kw">NULL</span>
<span class="no">titanic</span>$<span class="no">name</span> <span class="kw">=</span> <span class="kw">NULL</span>
<span class="no">titanic</span>$<span class="no">cabin</span> <span class="kw">=</span> <span class="kw">NULL</span>

<span class="no">titanic</span> <span class="kw">=</span> <span class="no">titanic</span>[!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">titanic</span>$<span class="no">survived</span>),]</pre></body></html></div>
<p>We construct a binary classification task.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">task</span> <span class="kw">=</span> <span class="no">TaskClassif</span>$<span class="fu">new</span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"titanic"</span>, <span class="kw">backend</span> <span class="kw">=</span> <span class="no">titanic</span>, <span class="kw">target</span> <span class="kw">=</span> <span class="st">"survived"</span>, <span class="kw">positive</span> <span class="kw">=</span> <span class="st">"1"</span>)</pre></body></html></div>
</div>
<div id="model" class="section level2">
<h2 class="hasAnchor">
<a href="#model" class="anchor"></a>Model</h2>
<p>We use the logistic regression learner provided by the <code>mlr3learners</code> package.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">learner</span> <span class="kw">=</span> <span class="fu">lrn</span>(<span class="st">"classif.log_reg"</span>)</pre></body></html></div>
<p>To evaluate the predictive performance, we choose a <code>3-fold-cross-validation</code> and the classification error as the measure.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">resampling</span> <span class="kw">=</span> <span class="fu">rsmp</span>(<span class="st">"repeated_cv"</span>, <span class="kw">folds</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">repeats</span> <span class="kw">=</span><span class="fl">20</span>)
<span class="no">measure</span> <span class="kw">=</span> <span class="fu">msr</span>(<span class="st">"classif.ce"</span>)</pre></body></html></div>
</div>
<div id="classes" class="section level2">
<h2 class="hasAnchor">
<a href="#classes" class="anchor"></a>Classes</h2>
<p>The <code>FSelectInstance</code> class specifies a general feature selection scenario. It evualates the feature sets provided by a feature selection algorithm, stores the results in an archive and offers methods to print the optimization path and best performing feature set.</p>
<p>The <code>Terminator*</code> subclasses determine when to stop the feature selection. In this example we choose a terminator that stops the feature selection after 10 seconds. The sugar functions <code><a href="../reference/term.html">term()</a></code> and <code><a href="../reference/terms.html">terms()</a></code> can be used to retrieve terminators from the <code>mlr_terminators</code> dictionary.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">terminator</span> <span class="kw">=</span> <span class="fu"><a href="../reference/term.html">term</a></span>(<span class="st">"clock_time"</span>, <span class="kw">secs</span> <span class="kw">=</span> <span class="fl">10</span>)

<span class="no">FSelectInstance</span>$<span class="fu">new</span>(<span class="no">task</span>, <span class="no">learner</span>, <span class="no">resampling</span>, <span class="no">measure</span>, <span class="no">terminator</span>)
<span class="co">#&gt; &lt;FSelectInstance&gt;</span>
<span class="co">#&gt; * Task: &lt;TaskClassif:titanic&gt;</span>
<span class="co">#&gt; * Learner: &lt;LearnerClassifLogReg:classif.log_reg&gt;</span>
<span class="co">#&gt; * Measures: classif.ce</span>
<span class="co">#&gt; * Resampling: &lt;ResamplingRepeatedCV&gt;</span>
<span class="co">#&gt; * Terminator: &lt;TerminatorClockTime&gt;</span>
<span class="co">#&gt; * bm_args: list()</span></pre></body></html></div>
<p>The <code>FSelect*</code> subclasses describe the feature selection strategy. The sugar function <code><a href="../reference/fs.html">fs()</a></code> can be used to retrieve feature selection algorithms from the <code>mlr_fselectors</code> dictionary.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">mlr_fselectors</span>
<span class="co">#&gt; &lt;DictionaryFSelect&gt; with 5 stored values</span>
<span class="co">#&gt; Keys: evolutionary, exhaustive, random, rfe, sequential</span></pre></body></html></div>
</div>
<div id="random-search" class="section level2">
<h2 class="hasAnchor">
<a href="#random-search" class="anchor"></a>Random search</h2>
<p>Random search randomly draws feature sets and evaluates them in batches. We retrieve the <code>FSelectRandom</code> class with the <code><a href="../reference/fs.html">fs()</a></code> sugar function and choose the <code>evals</code> terminator. We set the <code>n_evals</code> parameter to <code>10</code> which means that 10 feature sets are evaluated.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">7832</span>)
<span class="no">terminator</span> <span class="kw">=</span> <span class="fu"><a href="../reference/term.html">term</a></span>(<span class="st">"evals"</span>, <span class="kw">n_evals</span> <span class="kw">=</span> <span class="fl">10</span>)
<span class="no">instance</span> <span class="kw">=</span> <span class="no">FSelectInstance</span>$<span class="fu">new</span>(<span class="no">task</span>, <span class="no">learner</span>, <span class="no">resampling</span>, <span class="no">measure</span>, <span class="no">terminator</span>)
<span class="no">fs</span> <span class="kw">=</span> <span class="fu"><a href="../reference/fs.html">fs</a></span>(<span class="st">"random"</span>, <span class="kw">batch_size</span> <span class="kw">=</span> <span class="fl">5</span>)</pre></body></html></div>
<p>The feature selection is started by passing the <code>FSelectInstance</code> object to the <code>$select()</code> method of <code>FSelectRandom</code> which generates feature sets. These features set are internally passed to the <code>$eval_batch()</code> method of <code>FSelectInstance</code> which evaluates the feature sets and stores the results in an archive. This general interaction between the objects of <code>mlr3fselect</code> stays the same for the different feature selection methods. However, the way how new feature sets are generated differs depending on the chosen <code>FSelect*</code> class.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">fs</span>$<span class="fu">select</span>(<span class="no">instance</span>)</pre></body></html></div>
<p>We access the archive with the <code>$archive()</code> method which returns a <code>data.table</code> containing the resampling results of each evaluated feature set with the corresponding predictive performances.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">instance</span>$<span class="fu">archive</span>()
<span class="co">#&gt;     nr  resample_result task_id      learner_id resampling_id iters classif.ce</span>
<span class="co">#&gt;  1:  1 &lt;ResampleResult&gt; titanic classif.log_reg   repeated_cv    60  0.2992705</span>
<span class="co">#&gt;  2:  2 &lt;ResampleResult&gt; titanic classif.log_reg   repeated_cv    60  0.2039843</span>
<span class="co">#&gt;  3:  3 &lt;ResampleResult&gt; titanic classif.log_reg   repeated_cv    60  0.2075196</span>
<span class="co">#&gt;  4:  4 &lt;ResampleResult&gt; titanic classif.log_reg   repeated_cv    60  0.2154321</span>
<span class="co">#&gt;  5:  5 &lt;ResampleResult&gt; titanic classif.log_reg   repeated_cv    60  0.2132435</span>
<span class="co">#&gt;  6:  6 &lt;ResampleResult&gt; titanic classif.log_reg   repeated_cv    60  0.2127385</span>
<span class="co">#&gt;  7:  7 &lt;ResampleResult&gt; titanic classif.log_reg   repeated_cv    60  0.2127946</span>
<span class="co">#&gt;  8:  8 &lt;ResampleResult&gt; titanic classif.log_reg   repeated_cv    60  0.3326038</span>
<span class="co">#&gt;  9:  9 &lt;ResampleResult&gt; titanic classif.log_reg   repeated_cv    60  0.2182379</span>
<span class="co">#&gt; 10: 10 &lt;ResampleResult&gt; titanic classif.log_reg   repeated_cv    60  0.2087542</span>
<span class="co">#&gt;     batch_nr                               feat</span>
<span class="co">#&gt;  1:        1     age,embarked,fare,parch,pclass</span>
<span class="co">#&gt;  2:        1     age,embarked,pclass,sex,sib_sp</span>
<span class="co">#&gt;  3:        1             fare,pclass,sex,sib_sp</span>
<span class="co">#&gt;  4:        1        age,embarked,fare,parch,sex</span>
<span class="co">#&gt;  5:        1                       embarked,sex</span>
<span class="co">#&gt;  6:        2                     age,pclass,sex</span>
<span class="co">#&gt;  7:        2 age,embarked,fare,parch,sex,sib_sp</span>
<span class="co">#&gt;  8:        2            age,embarked,fare,parch</span>
<span class="co">#&gt;  9:        2                           fare,sex</span>
<span class="co">#&gt; 10:        2          embarked,parch,sex,sib_sp</span></pre></body></html></div>
<p>We retrieve the best performing feature set with</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">instance</span>$<span class="no">result</span>
<span class="co">#&gt; $feat</span>
<span class="co">#&gt; [1] "age"      "embarked" "pclass"   "sex"      "sib_sp"  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $perf</span>
<span class="co">#&gt; classif.ce </span>
<span class="co">#&gt;  0.2039843</span></pre></body></html></div>
</div>
<div id="sequential-forward-selection" class="section level2">
<h2 class="hasAnchor">
<a href="#sequential-forward-selection" class="anchor"></a>Sequential forward selection</h2>
<p>We try sequential forward selection. We chose the <code>stagnation</code> terminator that stops the feature selection if the predictive performance does not increase anymore.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">7832</span>)
<span class="no">terminator</span> <span class="kw">=</span> <span class="fu"><a href="../reference/term.html">term</a></span>(<span class="st">"none"</span>)
<span class="no">instance</span> <span class="kw">=</span> <span class="no">FSelectInstance</span>$<span class="fu">new</span>(<span class="no">task</span>, <span class="no">learner</span>, <span class="no">resampling</span>, <span class="no">measure</span>, <span class="no">terminator</span>)
<span class="no">fs</span> <span class="kw">=</span> <span class="fu"><a href="../reference/fs.html">fs</a></span>(<span class="st">"sequential"</span>)

<span class="no">fs</span>$<span class="fu">select</span>(<span class="no">instance</span>)</pre></body></html></div>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">instance</span>$<span class="fu">optimization_path</span>()
<span class="co">#&gt;    batch_nr age embarked fare parch pclass sex sib_sp classif.ce</span>
<span class="co">#&gt; 1:        1   0        0    0     0      0   1      0  0.2132435</span>
<span class="co">#&gt; 2:        2   0        0    0     0      0   1      1  0.2093154</span>
<span class="co">#&gt; 3:        3   0        0    0     0      1   1      1  0.2030303</span>
<span class="co">#&gt; 4:        4   0        0    0     1      1   1      1  0.2019080</span>
<span class="co">#&gt; 5:        5   0        0    1     1      1   1      1  0.2048822</span>
<span class="co">#&gt; 6:        6   1        0    1     1      1   1      1  0.2070707</span>
<span class="co">#&gt; 7:        7   1        1    1     1      1   1      1  0.2037037</span></pre></body></html></div>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">instance</span>$<span class="no">result</span>
<span class="co">#&gt; $feat</span>
<span class="co">#&gt; [1] "parch"  "pclass" "sex"    "sib_sp"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $perf</span>
<span class="co">#&gt; classif.ce </span>
<span class="co">#&gt;   0.201908</span></pre></body></html></div>
</div>
<div id="evolutionary" class="section level2">
<h2 class="hasAnchor">
<a href="#evolutionary" class="anchor"></a>Evolutionary</h2>
<p>For evolutionary search, we have to define the population and offspring parameter <code>mu</code> and <code>lambda</code>.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">7832</span>)
<span class="no">terminator</span> <span class="kw">=</span> <span class="fu"><a href="../reference/term.html">term</a></span>(<span class="st">"evals"</span>, <span class="kw">n_evals</span> <span class="kw">=</span> <span class="fl">120L</span>)
<span class="no">instance</span> <span class="kw">=</span> <span class="no">FSelectInstance</span>$<span class="fu">new</span>(<span class="no">task</span>, <span class="no">learner</span>, <span class="no">resampling</span>, <span class="no">measure</span>, <span class="no">terminator</span>)
<span class="no">fs</span> <span class="kw">=</span> <span class="fu"><a href="../reference/fs.html">fs</a></span>(<span class="st">"evolutionary"</span>, <span class="kw">mu</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">lambda</span> <span class="kw">=</span> <span class="fl">20</span>, <span class="kw">survival.strategy</span> <span class="kw">=</span> <span class="st">"plus"</span>)

<span class="no">fs</span>$<span class="fu">select</span>(<span class="no">instance</span>)</pre></body></html></div>
<p>We retrieve the best performing feature set with</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">instance</span>$<span class="no">result</span>
<span class="co">#&gt; $feat</span>
<span class="co">#&gt; [1] "age"    "fare"   "parch"  "pclass" "sex"    "sib_sp"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $perf</span>
<span class="co">#&gt; classif.ce </span>
<span class="co">#&gt;  0.2070707</span></pre></body></html></div>
</div>
<div id="exhaustive-search" class="section level2">
<h2 class="hasAnchor">
<a href="#exhaustive-search" class="anchor"></a>Exhaustive Search</h2>
<p>Let’s try exhaustive search which evaluates every possible feature subset. We choose the <code>none</code> terminator to evaluate all possible feature subsets. The small number of features and the fast learning time of logistic regression allows us to evaluate all feature subsets.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">7832</span>)
<span class="no">terminator</span> <span class="kw">=</span> <span class="fu"><a href="../reference/term.html">term</a></span>(<span class="st">"none"</span>)
<span class="no">instance</span> <span class="kw">=</span> <span class="no">FSelectInstance</span>$<span class="fu">new</span>(<span class="no">task</span>, <span class="no">learner</span>, <span class="no">resampling</span>, <span class="no">measure</span>, <span class="no">terminator</span>)
<span class="no">fs</span> <span class="kw">=</span> <span class="fu"><a href="../reference/fs.html">fs</a></span>(<span class="st">"exhaustive"</span>)

<span class="no">fs</span>$<span class="fu">select</span>(<span class="no">instance</span>)</pre></body></html></div>
<p>We get the best feature sets in increasing size with</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">instance</span>$<span class="fu">optimization_path</span>()
<span class="co">#&gt;    batch_nr age embarked fare parch pclass sex sib_sp classif.ce</span>
<span class="co">#&gt; 1:        1   0        0    0     0      0   1      0  0.2132435</span>
<span class="co">#&gt; 2:        2   0        0    0     0      0   1      1  0.2093154</span>
<span class="co">#&gt; 3:        3   0        0    0     0      1   1      1  0.2030303</span>
<span class="co">#&gt; 4:        4   0        0    0     1      1   1      1  0.2019080</span>
<span class="co">#&gt; 5:        5   1        1    0     0      1   1      1  0.2039843</span>
<span class="co">#&gt; 6:        6   1        1    1     0      1   1      1  0.2037037</span>
<span class="co">#&gt; 7:        7   1        1    1     1      1   1      1  0.2037037</span></pre></body></html></div>
<p>We retrieve the best performing feature set with</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">instance</span>$<span class="no">result</span>
<span class="co">#&gt; $feat</span>
<span class="co">#&gt; [1] "parch"  "pclass" "sex"    "sib_sp"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $perf</span>
<span class="co">#&gt; classif.ce </span>
<span class="co">#&gt;   0.201908</span></pre></body></html></div>
</div>
<div id="nested-resampling" class="section level2">
<h2 class="hasAnchor">
<a href="#nested-resampling" class="anchor"></a>Nested Resampling</h2>
<p>The feature selection should not be performed on the same resampling sets which are used for evaluating the model itself since this would result in biased performance estimates <span class="citation">(Bischl et al. 2012)</span>. Nested resampling uses an outer and inner resampling to separate the feature selection from the performance estimation of the model.</p>
<p>We choose <code>holdout</code> validation for the outer resampling loop to get a fixed test set. The outer training set is passed to the <code>AutoFSelect</code> objects to execute the feature selection. Then the learner is fitted on the outer training set using the selected feature sets and the performance is evaluated on the outer test set.</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">resampling_outer</span> <span class="kw">=</span> <span class="fu">rsmp</span>(<span class="st">"holdout"</span>)</pre></body></html></div>
<p>We use a <code>5-fold-cross-validation</code> to evaluate the predictive performance during the feature selection.</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="no">resampling_inner</span> <span class="kw">=</span> <span class="fu">rsmp</span>(<span class="st">"cv"</span>, <span class="kw">folds</span> <span class="kw">=</span> <span class="fl">5</span>)
<span class="no">measure</span> <span class="kw">=</span> <span class="fu">msr</span>(<span class="st">"classif.ce"</span>)
<span class="no">terminator</span> <span class="kw">=</span> <span class="fu"><a href="../reference/term.html">term</a></span>(<span class="st">"evals"</span>, <span class="kw">n_evals</span> <span class="kw">=</span> <span class="fl">120</span>)</pre></body></html></div>
<p>The <code>AutoFSelect</code> class inherits from the <code>Learner</code> class and starts an automatic feature selection when a task is passed to the <code>$train()</code> method.</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="no">fs_sequential</span> <span class="kw">=</span> <span class="fu"><a href="../reference/fs.html">fs</a></span>(<span class="st">"sequential"</span>)
<span class="no">at_sequential</span> <span class="kw">=</span> <span class="no">AutoFSelect</span>$<span class="fu">new</span>(<span class="no">learner</span>, <span class="no">resampling_inner</span>, <span class="kw">measures</span> <span class="kw">=</span> <span class="no">measure</span>, <span class="no">terminator</span>, <span class="kw">fselect</span> <span class="kw">=</span> <span class="no">fs_sequential</span>)
<span class="no">at_sequential</span>$<span class="no">store_fselect_instance</span> <span class="kw">=</span> <span class="fl">TRUE</span>

<span class="no">fs_evolutionary</span> <span class="kw">=</span> <span class="fu"><a href="../reference/fs.html">fs</a></span>(<span class="st">"evolutionary"</span>, <span class="kw">mu</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">lambda</span> <span class="kw">=</span> <span class="fl">20</span>, <span class="kw">survival.strategy</span> <span class="kw">=</span> <span class="st">"plus"</span>)
<span class="no">at_evolutionary</span> <span class="kw">=</span> <span class="no">AutoFSelect</span>$<span class="fu">new</span>(<span class="no">learner</span>, <span class="no">resampling_inner</span>, <span class="kw">measures</span> <span class="kw">=</span> <span class="no">measure</span>, <span class="no">terminator</span>, <span class="kw">fselect</span> <span class="kw">=</span> <span class="no">fs_evolutionary</span> )
<span class="no">at_evolutionary</span>$<span class="no">store_fselect_instance</span> <span class="kw">=</span> <span class="fl">TRUE</span>

<span class="no">fs_random</span> <span class="kw">=</span> <span class="fu"><a href="../reference/fs.html">fs</a></span>(<span class="st">"random"</span>)
<span class="no">at_random</span> <span class="kw">=</span> <span class="no">AutoFSelect</span>$<span class="fu">new</span>(<span class="no">learner</span>, <span class="no">resampling_inner</span>, <span class="kw">measures</span> <span class="kw">=</span> <span class="no">measure</span>, <span class="no">terminator</span>, <span class="kw">fselect</span> <span class="kw">=</span> <span class="no">fs_random</span>)
<span class="no">at_random</span>$<span class="no">store_fselect_instance</span> <span class="kw">=</span> <span class="fl">TRUE</span></pre></body></html></div>
<p>We combine each <code>AutoFSelect</code> learner with the task and resampling to a benchmark grid design.</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="no">design</span> <span class="kw">=</span> <span class="fu">benchmark_grid</span>(<span class="no">task</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">at_evolutionary</span>, <span class="no">at_sequential</span>, <span class="no">at_random</span>), <span class="no">resampling_outer</span>)
<span class="no">design</span>
<span class="co">#&gt;             task       learner          resampling</span>
<span class="co">#&gt; 1: &lt;TaskClassif&gt; &lt;AutoFSelect&gt; &lt;ResamplingHoldout&gt;</span>
<span class="co">#&gt; 2: &lt;TaskClassif&gt; &lt;AutoFSelect&gt; &lt;ResamplingHoldout&gt;</span>
<span class="co">#&gt; 3: &lt;TaskClassif&gt; &lt;AutoFSelect&gt; &lt;ResamplingHoldout&gt;</span></pre></body></html></div>
<p>Now we construct a benchmark call to execute the feature selection and performance evaluation at once.</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">7832</span>)
<span class="no">bmr</span> <span class="kw">=</span> <span class="fu">benchmark</span>(<span class="no">design</span>, <span class="kw">store_models</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p>We access the performance of the models estimated on the outer resampling test set.</p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="no">bmr</span>$<span class="fu">score</span>()
<span class="co">#&gt;    nr          task task_id       learner              learner_id</span>
<span class="co">#&gt; 1:  1 &lt;TaskClassif&gt; titanic &lt;AutoFSelect&gt; classif.log_reg.fselect</span>
<span class="co">#&gt; 2:  2 &lt;TaskClassif&gt; titanic &lt;AutoFSelect&gt; classif.log_reg.fselect</span>
<span class="co">#&gt; 3:  3 &lt;TaskClassif&gt; titanic &lt;AutoFSelect&gt; classif.log_reg.fselect</span>
<span class="co">#&gt;             resampling resampling_id iteration prediction classif.ce</span>
<span class="co">#&gt; 1: &lt;ResamplingHoldout&gt;       holdout         1     &lt;list&gt;  0.2121212</span>
<span class="co">#&gt; 2: &lt;ResamplingHoldout&gt;       holdout         1     &lt;list&gt;  0.1986532</span>
<span class="co">#&gt; 3: &lt;ResamplingHoldout&gt;       holdout         1     &lt;list&gt;  0.1818182</span></pre></body></html></div>
<p>In order to access the corresponding feature sets, we subset the <code>bmr$data</code> data table.</p>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="no">bmr</span>$<span class="no">data</span>$<span class="no">learner</span><span class="kw">[[</span><span class="fl">1</span>]]$<span class="no">fselect_result</span>
<span class="co">#&gt; $feat</span>
<span class="co">#&gt; [1] "fare"   "parch"  "pclass" "sex"   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $perf</span>
<span class="co">#&gt; classif.ce </span>
<span class="co">#&gt;  0.2037317</span>

<span class="no">bmr</span>$<span class="no">data</span>$<span class="no">learner</span><span class="kw">[[</span><span class="fl">2</span>]]$<span class="no">fselect_result</span>
<span class="co">#&gt; $feat</span>
<span class="co">#&gt; [1] "fare"   "parch"  "pclass" "sex"    "sib_sp"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $perf</span>
<span class="co">#&gt; classif.ce </span>
<span class="co">#&gt;  0.1953568</span>

<span class="no">bmr</span>$<span class="no">data</span>$<span class="no">learner</span><span class="kw">[[</span><span class="fl">3</span>]]$<span class="no">fselect_result</span>
<span class="co">#&gt; $feat</span>
<span class="co">#&gt; [1] "age"      "embarked" "fare"     "parch"    "pclass"   "sex"      "sib_sp"  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $perf</span>
<span class="co">#&gt; classif.ce </span>
<span class="co">#&gt;  0.2037032</span></pre></body></html></div>
</div>
<div id="recursive-feature-elimination" class="section level2">
<h2 class="hasAnchor">
<a href="#recursive-feature-elimination" class="anchor"></a>Recursive feature elimination</h2>
<p>Recrusive feature elemiation utilizes the <code>importance()</code> method of learners. In each iteration the feature with the lowest importance score is droped.</p>
<p>We choose the non-recruvie algorithm (<code>recursive = FALSE</code>) which calculates the feature importance once on the complete feature set. The recrusive version (<code>recursive = TRUE</code>) recomputes the feature importance on the reduced feature set in every iteration. The chosen algortihm depends on the used learner. In case of random forest, the rećomputation in every iteration might result in a decreased performance <span class="citation">(Svetnik et al. 2004)</span>.</p>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">7832</span>)
<span class="no">learner</span> <span class="kw">=</span> <span class="fu">lrn</span>(<span class="st">"classif.ranger"</span>, <span class="kw">importance</span> <span class="kw">=</span> <span class="st">"impurity"</span>)
<span class="no">terminator</span> <span class="kw">=</span> <span class="fu"><a href="../reference/term.html">term</a></span>(<span class="st">"none"</span>)
<span class="no">instance</span> <span class="kw">=</span> <span class="no">FSelectInstance</span>$<span class="fu">new</span>(<span class="no">task</span>, <span class="no">learner</span>, <span class="no">resampling</span>, <span class="no">measure</span>, <span class="no">terminator</span>)
<span class="no">fs</span> <span class="kw">=</span> <span class="fu"><a href="../reference/fs.html">fs</a></span>(<span class="st">"rfe"</span>, <span class="kw">recursive</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="no">fs</span>$<span class="fu">select</span>(<span class="no">instance</span>)</pre></body></html></div>
<p>We access the optimization path.</p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="no">instance</span>$<span class="fu">optimization_path</span>()
<span class="co">#&gt;    batch_nr age embarked fare parch pclass sex sib_sp classif.ce</span>
<span class="co">#&gt; 1:        1   0        0    0     0      0   1      0  0.2132435</span>
<span class="co">#&gt; 2:        2   0        0    0     0      0   1      1  0.2093154</span>
<span class="co">#&gt; 3:        3   0        0    0     0      1   1      1  0.2030303</span>
<span class="co">#&gt; 4:        4   0        0    0     1      1   1      1  0.2019080</span>
<span class="co">#&gt; 5:        5   1        1    0     0      1   1      1  0.2039843</span>
<span class="co">#&gt; 6:        6   1        1    1     0      1   1      1  0.2037037</span>
<span class="co">#&gt; 7:        7   1        1    1     1      1   1      1  0.2037037</span></pre></body></html></div>
<div id="refs" class="references">
<div id="ref-bischlResamplingMethodsMetaModel2012">
<p>Bischl, Bernd, O Mersmann, Heike Trautmann, and Claus Weihs. 2012. “Resampling Methods for Meta-Model Validation with Recommendations for Evolutionary Computation.” <em>Evolutionary Computation</em> 20 (February): 249–75. <a href="https://doi.org/10.1162/EVCO_a_00069">https://doi.org/10.1162/EVCO_a_00069</a>.</p>
</div>
<div id="ref-svetnikApplicationBreimanRandom2004">
<p>Svetnik, Vladimir, Andy Liaw, Christopher Tong, and Ting Wang. 2004. “Application of Breiman’s Random Forest to Modeling Structure-Activity Relationships of Pharmaceutical Molecules.” In <em>Multiple Classifier Systems</em>, 334–43. Springer, Berlin, Heidelberg. <a href="https://doi.org/10.1007/978-3-540-25966-4_33">https://doi.org/10.1007/978-3-540-25966-4_33</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Marc Becker, Patrick Schratz, Michel Lang, Bernd Bischl.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
